(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();let m,d,r=0,f,T="",A="";const v="https://api-loyalty.therealreward.com",_="E2ejhMb8pnNcm3nmyU4eaQzW4n02s5nd",D="2wK2xE6kJo3MeNv2";let x="",k=[],P="PUBLISHED",M=Phaser.Math.FloatBetween(2,43);const N={type:Phaser.AUTO,width:690,height:window.innerHeight,parent:"game-container",resolution:2,scene:{preload:E,create:j,update:U}};let y=[{val:-1,label:"Jelly 1 Stick",code:"C001",weight:0,img:"reward_r001"},{val:-2,label:"Tote Bag",code:"C002",weight:0,img:"reward_r002"},{val:-3,label:"Sakkin Kid",code:"C003",weight:0,img:"reward_r003"},{val:-4,label:"Sakkin 100ml",code:"C004",weight:0,img:"reward_r004"},{val:3,label:"Sakkin Veggie",code:"C005",weight:0,img:"reward_r005"},{val:1,label:"Aojiru 1 Box",code:"C006",weight:0,img:"reward_r006"},{val:2,label:"Aojiru Gift $10",code:"C007",weight:0,img:"reward_r007"},{val:0,label:"Voucher $10",code:"C008",weight:0,img:"reward_r008"}];function L(e){return new URLSearchParams(window.location.search).get(e)}function O(e){const t=CryptoJS.enc.Utf8.parse(_),n=CryptoJS.enc.Utf8.parse(D);return CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(e),t,{keySize:128/8,iv:n,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}).toString()}const $=L("_t"),b=atob($);var R;const I=(R=b==null?void 0:b.split("-"))==null?void 0:R.pop(),B=b.substring(0,b.lastIndexOf("-"));B&&I?(T=B,A=I):window.location.href="404";async function W(){var e,t;try{let n={key:O.call(this,T),secret:O.call(this,A)};const a=await axios.post(`${v}/partner/v1/login`,n,{headers:{"Content-Type":"application/json"}});a.data.response.status>=400&&(window.location.href="404"),a.data.response.status==200&&(x=(t=(e=a.data)==null?void 0:e.results)==null?void 0:t.token)}catch(n){console.error("Error fetching data:",n)}}async function C(){try{await W.call(),k=(await axios.post(`${v}/partner/v1/lucky-reward`,"",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`}})).data.results,await F.call()}catch(e){console.error("Error fetching data:",e)}}async function q(e){try{return await W.call(),(await axios.post(`${v}/partner/v1/lucky-reward/check`,{key:e},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`}})).data.results.code}catch(t){console.error("Error fetching data:",t)}}function E(){z.call(this),this.load.audio("introSound","assets/audios/intro.mp3"),this.load.audio("collectSound","assets/audios/collect.mp3"),this.load.audio("spinSound","assets/audios/spinSound.mp3"),this.load.image("activeIcon","assets/images/active.png"),this.load.image("forceCloseBtn","assets/images/forceClose.png"),this.load.image("reload","assets/images/reload.png"),this.load.image("background","assets/images/background.png"),this.load.image("wheel","assets/images/wheel.png"),this.load.image("bgWheelTop","assets/images/bgWheelTop.png"),this.load.image("bgWheel","assets/images/bgWheel.png"),this.load.image("pin","assets/images/pin.png"),this.load.image("spinButton","assets/images/spinButton.png"),this.load.image("spinButtonDown","assets/images/spinButtonDown.png"),this.load.image("bgReward","assets/images/blur.png"),this.load.image("box","assets/images/box.png"),this.load.image("btnClaim","assets/images/btnClaim.png"),this.load.image("icSound","assets/images/sound.png"),this.load.image("icSoundOff","assets/images/soundOff.png"),this.load.image("bgCoin","assets/images/bgCoin.png"),this.load.image("btnAdd","assets/images/add.png"),this.load.image("btnMinus","assets/images/minus.png"),this.load.image("reward_r001","assets/images/r001.png"),this.load.image("reward_r002","assets/images/r002.png"),this.load.image("reward_r003","assets/images/r003.png"),this.load.image("reward_r004","assets/images/r004.png"),this.load.image("reward_r005","assets/images/r005.png"),this.load.image("reward_r006","assets/images/r006.png"),this.load.image("reward_r007","assets/images/r007.png"),this.load.image("reward_r008","assets/images/r008.png"),this.load.spritesheet("firework","assets/images/firework.png",{frameWidth:480,frameHeight:480,endFrame:10}),this.load.script("webfont","https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js")}function z(){this.cameras.main.setBackgroundColor("#ffa93a");const e=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2-30,"Loading: 0%",{font:"20px Arial",fill:"#ffffff"}).setOrigin(.5),t=this.add.graphics(),n=(this.cameras.main.width-200)/2,a=this.cameras.main.height/2,i=200,s=10,l=5;t.fillStyle(16777215,.5),t.fillRoundedRect(n,a,i,s,l);const o=this.add.graphics();this.load.on("progress",h=>{o.clear(),o.fillStyle(16777215,1),o.fillRoundedRect(n,a,i*h,s,l),e.setText(`Loading: ${Math.round(h*100)}%`)}),this.load.on("complete",()=>{o.destroy(),t.destroy(),e.destroy()}),this.load.on("complete",()=>{o.destroy(),t.destroy(),e.destroy()})}async function j(){let e=!0;await C.call(),await S.call();const t=this.sound.add("introSound"),n=this.sound.add("collectSound"),a=this.sound.add("spinSound");this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,"background").setOrigin(.5,.5).setDisplaySize(this.cameras.main.width,this.cameras.main.height);const i=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height/2,"icSoundOff");i.setPosition(this.cameras.main.width-12,12),i.setOrigin(1,-.1),i.setScale(.5);const s=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height/2,"icSound");s.setPosition(this.cameras.main.width-12,12),s.setOrigin(1,-.1),s.setScale(.5);const l=this.add.sprite(50,s.y,"reload");l.setDisplaySize(32,32),l.setOrigin(1,0),l.setInteractive(),l.on("pointerdown",()=>{C.call(this)});const o=this.add.sprite(s.x-s.displayWidth-10,s.y,"btnAdd");o.setScale(.7),o.setOrigin(1,0),o.setInteractive(),o.on("pointerdown",()=>{r||(r=0),r=parseInt(r)+1,localStorage.setItem("spinNumber",r),S.call(),f.setText(`${r}`)}),f=this.add.text(s.x-s.displayWidth-70,42,`${r}`,{font:"24px Arial",fill:"#000000"}),f.setOrigin(.5,1);const h=this.add.sprite(s.x-s.displayWidth-100,s.y,"btnMinus");h.setScale(.7),h.setOrigin(1,0),h.setInteractive(),h.on("pointerdown",()=>{r>0&&(r=r-1),localStorage.setItem("spinNumber",r),S.call(),f.setText(`${r}`)});const p=this.add.sprite(this.cameras.main.width/2,220,"bgWheelTop");p.setScale(.8),p.setOrigin(.5,.5);const c=this.add.sprite(this.cameras.main.width/2,450,"wheel");c.setScale(.73),c.setOrigin(.5,.5);const g=this.add.sprite(this.cameras.main.width/2,450,"bgWheel");g.setScale(.81),g.setOrigin(.5,.5),d=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height-200,"spinButton"),d.setScale(.55),d.setOrigin(.5,1),d.setInteractive(),d.on("pointerdown",()=>{d.setTexture("spinButtonDown")}),d.on("pointerup",J.bind(this,c,a,n,w)),d.on("pointerout",()=>{d.setTexture("spinButton")}),s.setInteractive(),s.on("pointerdown",()=>{e=!e,t.setMute(e),n.setMute(e),a.setMute(e),e?s.setTexture("icSound"):(s.setTexture("icSoundOff"),t.play())})}function U(){}new Phaser.Game(N);function J(e,t,n,a){if(r<1){a("Please Top up to spin!");return}d.setTexture("spinButton"),d.disableInteractive();const i=V(y),s=y.indexOf(i),l=360/y.length,o=M,h=s*l+o,c=360*Phaser.Math.Between(2,4)+h;this.tweens.add({targets:e,angle:c,ease:Phaser.Math.Easing.Cubic.Out,duration:Phaser.Math.Between(4e3,5e3),onStart:()=>t.play(),onComplete:()=>{t.stop(),n.play(),a(i.label),H.call(this,i)}})}function V(e){const t=e.reduce((a,i)=>a+i.weight,0);let n=Math.random()*t;for(const a of e){if(n<a.weight)return a;n-=a.weight}}function H(e){let t=k.find(u=>u.ref==e.code).item;t=t.filter(u=>u.status==P);let n=t[0].data;this.anims.create({key:"fireworkAnim",frames:this.anims.generateFrameNumbers("firework",{frames:[0,1,2,3,4,5,6,7,8,9]}),frameRate:16,repeat:-1});const a=this.add.sprite(200,100,"firework");a.play("fireworkAnim",!0),a.setDepth(1e3),a.setDisplaySize(250,250);const i=this.add.sprite(100,300,"firework");i.play("fireworkAnim",!0),i.setDepth(1e3),i.setDisplaySize(200,200);const s=this.add.sprite(this.cameras.main.width-75,250,"firework");s.play("fireworkAnim",!0),s.setDepth(1e3),s.setDisplaySize(150,150);const l=this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,"bgReward");l.setOrigin(.5,.5),l.setDisplaySize(this.cameras.main.width,this.cameras.main.height);const o=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height/2-50,`${e.img}`);o.setOrigin(.5,.5),o.setScale(.2),Q.call(this,n,o);const h={font:"32px Charm",fill:"#ffffff",align:"center",resolution:2},p=this.add.text(this.cameras.main.centerX,o.y-o.displayHeight+230,`Congratulations!
You won ${e.label}`,h);p.setOrigin(.5,.5);const c=this.add.image(this.cameras.main.centerX,this.cameras.main.height-300,"btnClaim");c.setOrigin(.5,.5),c.setScale(.7),c.setInteractive();const g=this.add.sprite(this.cameras.main.width-50,50,"forceCloseBtn");g.setOrigin(.5,.5),g.setScale(1),g.setInteractive(),c.on("pointerdown",async()=>{let u=await q.call(this,n);if(!u){w("Something went wrong");return}if(u=="00"){w("Reward Not Claimed");return}else if(u=="02"){w("Reward link is invalid");return}await C.call(),w("Claim Success!"),l.destroy(),p.destroy(),o.destroy(),c.destroy(),a.destroy(),i.destroy(),s.destroy(),g.destroy(),m&&(m.destroy(),m=null,this.textures.exists("qrCanvas")&&this.textures.remove("qrCanvas")),d.setInteractive(),K.call()}),g.on("pointerdown",async()=>{l.destroy(),p.destroy(),o.destroy(),c.destroy(),a.destroy(),i.destroy(),s.destroy(),g.destroy(),m&&(m.destroy(),m=null,this.textures.exists("qrCanvas")&&this.textures.remove("qrCanvas")),d.setInteractive()})}function Q(e,t){const n=new QRious({value:e,size:152}),a=new Image;a.src=n.toDataURL(),a.onload=()=>{const i=this.textures.createCanvas("qrCanvas",a.width,a.height);i.context.drawImage(a,0,0),i.refresh(),m=this.add.image(t.x,t.y+t.displayHeight/2-16,"qrCanvas"),m.setOrigin(.5,1)},a.onerror=()=>{console.error("Failed to load QR code image.")}}function S(){const e=localStorage.getItem("spinNumber");e&&(r=e),d&&(r==0?d.disableInteractive():d.setInteractive())}async function F(){y=y.map(e=>{let t=k.find(a=>a.ref===e.code);const n=t?t.item.filter(a=>a.status===P).length:0;return{...e,weight:n}})}function K(){r&&r>0?r=r-1:r=0,d&&(r==0?d.disableInteractive():d.setInteractive()),localStorage.setItem("spinNumber",r),f.setText(`${r}`)}function w(e){const t=document.getElementById("toast");t.textContent=e,t.classList.add("show"),setTimeout(()=>{t.classList.remove("show")},3e3)}
