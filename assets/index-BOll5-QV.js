(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function a(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(t){if(t.ep)return;t.ep=!0;const r=a(t);fetch(t.href,r)}})();let g,c,o=0,w,k=5,R="",y="",W="",$="";const T="https://api-loyalty.therealreward.com",K="E2ejhMb8pnNcm3nmyU4eaQzW4n02s5nd",X="2wK2xE6kJo3MeNv2";let A="",f=[],z="PUBLISHED",Y=Phaser.Math.FloatBetween(2,43);const G={type:Phaser.AUTO,width:690,height:window.innerHeight,parent:"game-container",resolution:2,scene:{preload:te,create:ie,update:ae}};let m=[{val:-1,label:"Jelly 1 Stick",code:"C001",weight:0,img:"reward_r001"},{val:-2,label:"Tote Bag",code:"C002",weight:0,img:"reward_r002"},{val:-3,label:"Sakkin Kid",code:"C003",weight:0,img:"reward_r003"},{val:-4,label:"Sakkin 100ml",code:"C004",weight:0,img:"reward_r004"},{val:3,label:"Sakkin Veggie",code:"C005",weight:0,img:"reward_r005"},{val:1,label:"Aojiru 1 Box",code:"C006",weight:0,img:"reward_r006"},{val:2,label:"Aojiru Gift $10",code:"C007",weight:0,img:"reward_r007"},{val:0,label:"Voucher $100",code:"C008",weight:0,img:"reward_r008"}];function O(s){return new URLSearchParams(window.location.search).get(s)}function E(s){const e=CryptoJS.enc.Utf8.parse(K),a=CryptoJS.enc.Utf8.parse(X);return CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(s),e,{keySize:128/8,iv:a,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}).toString()}const Z=O("_t"),_=O("_tcode"),N=O("_bcode"),D=O("_min"),C=atob(Z);var q;const P=(q=C==null?void 0:C.split("-"))==null?void 0:q.pop(),M=C.substring(0,C.lastIndexOf("-"));_&&(y=_);N&&(R=N);D&&(k=parseInt(D)-1);M&&P?(W=M,$=P):window.location.href="404";console.log(" topCode ",y);console.log(" minLimitPriority ",k);async function F(){var s,e;try{let a={key:E.call(this,W),secret:E.call(this,$)};const i=await axios.post(`${T}/partner/v1/login`,a,{headers:{"Content-Type":"application/json"}});i.data.response.status>=400&&(window.location.href="404"),i.data.response.status==200&&(A=(e=(s=i.data)==null?void 0:s.results)==null?void 0:e.token)}catch(a){console.error("Error fetching data:",a)}}async function I(){try{await F.call(),f=(await axios.post(`${T}/partner/v1/lucky-reward`,"",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${A}`}})).data.results;let e=localStorage.getItem("rewardLinks");if(e){let a=e==null?void 0:e.split(",");for(let i=0;i<a.length;i++)j.call(this,f,a[i],"CLAIMED")}await ge.call(),console.log("rewardList ",m)}catch(s){console.error("Error fetching data:",s)}}async function ee(s){try{return await F.call(),(await axios.post(`${T}/partner/v1/lucky-reward/check`,{key:s},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${A}`}})).data.results.code}catch(e){console.error("Error fetching data:",e)}}function te(){se.call(this),this.load.audio("introSound","assets/audios/intro.mp3"),this.load.audio("collectSound","assets/audios/collect.mp3"),this.load.audio("spinSound","assets/audios/spinSound.mp3"),this.load.image("resetIcon","assets/images/reset.png"),this.load.image("scanIcon","assets/images/scan.png"),this.load.image("activeIcon","assets/images/active.png"),this.load.image("forceCloseBtn","assets/images/forceClose.png"),this.load.image("reload","assets/images/reload.png"),this.load.image("background","assets/images/background.png"),this.load.image("wheel","assets/images/wheel.png"),this.load.image("bgWheelTop","assets/images/bgWheelTop.png"),this.load.image("bgWheel","assets/images/bgWheel.png"),this.load.image("pin","assets/images/pin.png"),this.load.image("spinButton","assets/images/spinButton.png"),this.load.image("spinButtonDown","assets/images/spinButtonDown.png"),this.load.image("bgReward","assets/images/blur.png"),this.load.image("box","assets/images/box.png"),this.load.image("btnClaim","assets/images/btnClaim.png"),this.load.image("icSound","assets/images/soundOff.png"),this.load.image("icSoundOff","assets/images/sound.png"),this.load.image("bgCoin","assets/images/bgCoin.png"),this.load.image("bgSpinNumber","assets/images/bgSpinNumber.png"),this.load.image("btnAdd","assets/images/add.png"),this.load.image("btnMinus","assets/images/minus.png"),this.load.image("bgScanQR","assets/images/bgScanQR.png"),this.load.image("reward_r001","assets/images/r001.png"),this.load.image("reward_r002","assets/images/r002.png"),this.load.image("reward_r003","assets/images/r003.png"),this.load.image("reward_r004","assets/images/r004.png"),this.load.image("reward_r005","assets/images/r005.png"),this.load.image("reward_r006","assets/images/r006.png"),this.load.image("reward_r007","assets/images/r007.png"),this.load.image("reward_r008","assets/images/r008.png"),this.load.spritesheet("firework","assets/images/firework.png",{frameWidth:480,frameHeight:480,endFrame:84}),this.load.script("webfont","https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js")}function se(){this.cameras.main.setBackgroundColor("#ee3535");const s=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2-30,"Loading: 0%",{font:"20px Arial",fill:"#ffffff"}).setOrigin(.5),e=this.add.graphics(),a=(this.cameras.main.width-200)/2,i=this.cameras.main.height/2,t=200,r=10,n=5;e.fillStyle(16777215,.5),e.fillRoundedRect(a,i,t,r,n);const l=this.add.graphics();this.load.on("progress",d=>{l.clear(),l.fillStyle(16777215,1),l.fillRoundedRect(a,i,t*d,r,n),s.setText(`Loading: ${Math.round(d*100)}%`)}),this.load.on("complete",()=>{l.destroy(),e.destroy(),s.destroy()}),this.load.on("complete",()=>{l.destroy(),e.destroy(),s.destroy()})}async function ie(){let s=!0;await I.call(),await B.call();const e=this.sound.add("introSound"),a=this.sound.add("collectSound"),i=this.sound.add("spinSound");this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,"background").setOrigin(.5,.5).setDisplaySize(this.cameras.main.width,this.cameras.main.height);const t=this.add.sprite(20,160,"icSound");t.setOrigin(0,0),t.setScale(1);const r=this.add.sprite(150,24,"reload");r.setScale(.34),r.setOrigin(1,0),r.setInteractive(),r.on("pointerdown",()=>{I.call(this)});const n=this.add.sprite(130,100,"resetIcon");n.setOrigin(1,0),n.setInteractive(),n.on("pointerdown",()=>{Q.call(this),I.call()});const l=this.add.sprite(this.cameras.main.width-260,50,"scanIcon");l.setInteractive(),l.on("pointerdown",()=>{L.call(this)?le.call(this):u.call(this,"No Reward")}),this.add.sprite(this.cameras.main.width-110,50,"bgSpinNumber");const d=this.add.sprite(this.cameras.main.width-50,50,"btnAdd");d.setScale(.7),d.setInteractive(),d.on("pointerdown",()=>{o||(o=0),o=parseInt(o)+1,localStorage.setItem("spinNumber",o),B.call(),w.setText(`${o}`)}),w=this.add.text(this.cameras.main.width-85,38,`${o}`,{font:"24px Arial",fill:"#FFFFFF"}),w.setOrigin(.5,0);const b=this.add.sprite(this.cameras.main.width-120,50,"btnMinus");b.setScale(.7),b.setInteractive(),b.on("pointerdown",()=>{o>0&&(o=o-1),localStorage.setItem("spinNumber",o),B.call(),w.setText(`${o}`)});const v=this.add.sprite(this.cameras.main.width/2,270,"bgWheelTop");v.setScale(.8),v.setOrigin(.5,.5);const S=this.add.sprite(this.cameras.main.width/2,530,"wheel");S.setScale(.67),S.setOrigin(.5,.5);const x=this.add.sprite(this.cameras.main.width/2,530,"bgWheel");x.setScale(.74),x.setOrigin(.5,.5),c=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height-100,"spinButton"),c.setScale(.4),c.setOrigin(.5,1),c.setInteractive(),c.on("pointerdown",()=>{c.setTexture("spinButtonDown")}),c.on("pointerup",re.bind(this,S,i,a,u)),c.on("pointerout",()=>{c.setTexture("spinButton")}),t.setInteractive(),t.on("pointerdown",()=>{s=!s,e.setMute(s),a.setMute(s),i.setMute(s),s?t.setTexture("icSound"):(t.setTexture("icSoundOff"),e.play({loop:!0}))})}function ae(){}new Phaser.Game(G);function re(s,e,a,i){if(o<1){i("Please Top up to spin!");return}c.setTexture("spinButton"),c.disableInteractive();let t=localStorage.getItem("rewardLinks"),r=!1,n=!1,l="";if(t){let h=t==null?void 0:t.split(",");for(let p=0;p<h.length;p++)if(ce.call(this,f,h[p])){r=!0;break}for(let p=0;p<h.length;p++)if(de.call(this,f,h[p])){n=!0;break}}console.log("bigRewardExist ",r),console.log("topRewardExist ",n),console.log("rewards length ",t==null?void 0:t.split(",").length);const d=m.find(h=>h.code==y),b=m.find(h=>R.split(",").includes(h.code));(t==null?void 0:t.split(",").length)>=k&&!n&&d.weight>0?l=m.find(h=>h.code==y):(t==null?void 0:t.split(",").length)>=10&&!r&&b.weight>0?l=m.find(h=>R.split(",").includes(h.code)):l=ne(m),console.log("selectedReward ",l);const v=m.indexOf(l),S=360/m.length,x=Y,U=v*S+x,J=360*Phaser.Math.Between(2,4)+U;this.tweens.add({targets:s,angle:J,ease:Phaser.Math.Easing.Cubic.Out,duration:Phaser.Math.Between(4e3,5e3),onStart:()=>e.play(),onComplete:()=>{e.stop(),a.play(),oe.call(this,l)}})}function ne(s){let e=localStorage.getItem("rewardLinks"),a=s;console.log("rewards?.split(",").length < minLimitPriority ",(e==null?void 0:e.split(",").length)<k),(!e||(e==null?void 0:e.split(",").length)<k)&&(a=s.filter(r=>r.code!=y)),console.log("_rewardList ",a);const i=a.reduce((r,n)=>r+n.weight,0);let t=Math.random()*i;for(const r of a){if(t<r.weight)return r;t-=r.weight}}function oe(s){console.log("reward ",s.code),u.call(this,s.code);let e=f.find(d=>d.ref==s.code).item;e=e.filter(d=>d.status==z);let a=e[0].data;this.anims.create({key:"fireworkAnim",frames:this.anims.generateFrameNumbers("firework",{frames:[...Array(85).keys()]}),frameRate:24,repeat:-1}),me.call(this,a),j.call(this,f,a,"CLAIMED"),V.call();const i=this.add.sprite(80,100,"firework");i.play("fireworkAnim",!0),i.setDepth(1e3),i.setDisplaySize(250,250);const t=this.add.sprite(this.cameras.main.width-80,100,"firework");t.play("fireworkAnim",!0),t.setDepth(1e3),t.setDisplaySize(250,250);const r=this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,"bgReward");r.setOrigin(.5,.5),r.setDisplaySize(this.cameras.main.width,this.cameras.main.height);const n=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height/2-100,`${s.img}`);n.setOrigin(.5,.5),n.setScale(.5);const l=this.add.sprite(this.cameras.main.width-50,50,"forceCloseBtn");l.setOrigin(.5,.5),l.setScale(1),l.setInteractive(),setTimeout(()=>{r.destroy(),n.destroy(),i.destroy(),t.destroy(),l.destroy(),g&&(g.destroy(),g=null,this.textures.exists("qrCanvas")&&this.textures.remove("qrCanvas")),c.setInteractive()},4e3)}function le(){this.anims.create({key:"fireworkAnim",frames:this.anims.generateFrameNumbers("firework",{frames:[...Array(85).keys()]}),frameRate:24,repeat:-1});const s=this.add.sprite(80,100,"firework");s.play("fireworkAnim",!0),s.setDepth(1e3),s.setDisplaySize(250,250);const e=this.add.sprite(this.cameras.main.width-80,100,"firework");e.play("fireworkAnim",!0),e.setDepth(1e3),e.setDisplaySize(250,250);const a=this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,"bgReward");a.setOrigin(.5,.5),a.setDisplaySize(this.cameras.main.width,this.cameras.main.height);const i=this.add.sprite(this.cameras.main.width/2,this.cameras.main.height/2-50,"bgScanQR");i.setOrigin(.5,.5),i.setScale(.25),he.call(this,L.call(this),i);const t=this.add.image(this.cameras.main.centerX,this.cameras.main.height-170,"btnClaim");t.setOrigin(.5,.5),t.setScale(.25),t.setInteractive();const r=this.add.sprite(this.cameras.main.width-50,50,"forceCloseBtn");r.setOrigin(.5,.5),r.setScale(1),r.setInteractive(),t.on("pointerdown",async()=>{let n=await ee.call(this,L.call(this));if(!n){u("Something went wrong");return}if(n=="00"){u("Reward Not Claimed");return}else if(n=="02"){u("Reward link is invalid");return}Q.call(this),await I.call(),u("Claim Success!"),a.destroy(),i.destroy(),t.destroy(),s.destroy(),e.destroy(),r.destroy(),g&&(g.destroy(),g=null,this.textures.exists("qrCanvas")&&this.textures.remove("qrCanvas")),c.setInteractive(),V.call()}),r.on("pointerdown",async()=>{a.destroy(),i.destroy(),t.destroy(),s.destroy(),e.destroy(),r.destroy(),g&&(g.destroy(),g=null,this.textures.exists("qrCanvas")&&this.textures.remove("qrCanvas")),c.setInteractive()})}function j(s,e,a){s.forEach(i=>{i.item.forEach(t=>{t.data.includes(e)&&(t.status=a)})})}function ce(s,e){let a=R.split(",");return s.some(i=>i.item.some(t=>!!(t.data.includes(e)&&a.includes(i.ref))))}function de(s,e){return s.some(a=>a.item.some(i=>!!(i.data.includes(e)&&a.ref===y)))}function he(s,e){const a=new QRious({value:s,size:420,level:"L"}),i=new Image;i.src=a.toDataURL(),i.onload=()=>{const t=this.textures.createCanvas("qrCanvas",i.width,i.height);t.context.drawImage(i,0,0),t.refresh(),g=this.add.image(e.x,e.y+e.displayHeight/2-30,"qrCanvas"),g.setOrigin(.5,1)},i.onerror=()=>{console.error("Failed to load QR code image.")}}function B(){const s=localStorage.getItem("spinNumber");s&&(o=s),c&&(o==0?c.disableInteractive():c.setInteractive())}async function ge(){m=m.map(s=>{let e=f.find(i=>i.ref===s.code);const a=e?e.item.filter(i=>i.status===z).length:0;return{...s,weight:a}})}function V(){o&&o>0?o=o-1:o=0,c&&(o==0?c.disableInteractive():c.setInteractive()),localStorage.setItem("spinNumber",o),w.setText(`${o}`)}function u(s){const e=document.getElementById("toast");e.textContent=s,e.classList.add("show"),setTimeout(()=>{e.classList.remove("show")},3e3)}function me(s){let e=L.call(this),a=(e==null?void 0:e.split(","))||[];a.push(s),localStorage.setItem("rewardLinks",a.join(","))}function L(){return localStorage.getItem("rewardLinks")}function Q(){localStorage.removeItem("spinNumber"),o=0,w.setText("0"),localStorage.removeItem("rewardLinks")}
